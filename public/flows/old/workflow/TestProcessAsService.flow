attributes:
  NodeStyle: BoxIcon
  PROCESS_VISIBILITY: SERVICE
  Response to Invoker: When Terminate
  START_TRANSITION_ID: '2331845'
  Transition with no Label: Matches Any Return Code
  display: x=48,y=37,w=248,h=27
steps:
- id: s7
  name: Start
  path: flowbee-demo.start
  attributes:
    display: x=26,y=280,w=60,h=40
  links:
  - id: l21
    attributes:
      display: type=Elbow,x=116,y=300,xs=90&143,ys=300&300
    to: s13
- id: s1
  name: Count > 100?
  path: flowbee-demo.decision
  attributes:
    Expression: 'count > 99 ?  ''TRUE'' : ''FALSE'''
    SCRIPT: Groovy
    display: x=704,y=392,w=90,h=47
  links:
  - id: l10
    attributes:
      TRANSITION_DELAY: '0'
      TRANSITION_RETRY_COUNT: '0'
      display: type=ElbowH,x=856,y=363,xs=798&896,ys=415&160
    to: s3
    result: 'TRUE'
  - id: l11
    attributes:
      TRANSITION_DELAY: '0'
      TRANSITION_RETRY_COUNT: '200'
      display: type=Elbow,x=749,y=461,xs=749&749,ys=443&483
    to: s9
    result: 'FALSE'
- id: s2
  name: Display Response
  path: flowbee-demo.script.ScriptExecutorActivity
  attributes:
    Rule: println response
    SCRIPT: Groovy
    display: x=687,y=268,w=100,h=60
  links:
  - id: l7
    attributes:
      display: type=Elbow,x=666,y=261,xs=791&896,ys=298&160
    to: s3
- id: s12
  name: Call a web service
  path: flowbee-demo.adapter.soap.DocumentWebServiceAdapter
  attributes:
    DO_LOGGING: 'True'
    PostScriptLang: Groovy
    PreScriptLang: Groovy
    REQUEST_VARIABLE: req
    RESPONSE_VARIABLE: response
    SERVICE: invokeWebService
    WSDL: '#{props[''services.url'']}/SOAP/Employee.wsdl'
    display: x=564,y=272,w=100,h=60
  links:
  - id: l6
    attributes:
      display: type=Elbow,x=660,y=293,xs=668&683,ys=300&300
    to: s2
- id: s10
  name: count = 0
  path: flowbee-demo.script.ScriptExecutorActivity
  attributes:
    Rule: |-
      /*document response;
       & $response = "LoadTestResponse";
       $response.Status = "OK";
       $count = 0;
       */
      import javax.xml.parsers.DocumentBuilder;
      import javax.xml.parsers.DocumentBuilderFactory;
      import org.w3c.dom.Document;
      import org.w3c.dom.Element;

      DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
      DocumentBuilder builder = dbf.newDocumentBuilder();

      Document response = builder.newDocument();
      Element element = response.createElement("LoadTestResponse");
      response.appendChild(element);

      Element itemElement = response.createElement("Status");
      itemElement.appendChild(response.createTextNode('OK'));
      element.appendChild(itemElement);

      count=0
    SCRIPT: Groovy
    display: x=432,y=391,w=100,h=60
  links:
  - id: l9
    attributes:
      display: type=Elbow,x=622,y=415,xs=536&700,ys=415&415
    to: s1
- id: s8
  name: Set up request
  path: flowbee-demo.script.ScriptExecutorActivity
  attributes:
    Output Documents: req
    Rule: ""
    SCRIPT: Groovy
    display: x=435,y=272,w=100,h=60
  links:
  - id: l5
    attributes:
      display: type=ElbowH,x=552,y=302,xs=539&560,ys=302&302
    to: s12
- id: s9
  name: count = count + 1
  path: flowbee-demo.script.ScriptExecutorActivity
  attributes:
    Rule: |
      count = count + 1;
    SCRIPT: Groovy
    display: x=699,y=487,w=100,h=60
  links:
  - id: l12
    attributes:
      TRANSITION_DELAY: '0'
      TRANSITION_RETRY_COUNT: '200'
      display: type=ElbowH,x=749,y=413,xs=695&616&616&700,ys=504&504&416&416
    to: s1
- id: s3
  name: Stop
  path: flowbee-demo.stop
  attributes:
    display: x=900,y=140,w=60,h=40
- id: s6
  name: Get OrderId
  path: flowbee-demo.script.ScriptExecutorActivity
  attributes:
    Output Documents: response
    Rule: |-
      import groovy.util.XmlParser

      def orderDoc = new XmlParser().parseText(order)
      def orderId = orderDoc.orderId.text()
      response = "<orderId>" + orderId + "</orderId>"
    SCRIPT: Groovy
    display: x=483,y=26,w=100,h=60
  links:
  - id: l16
    attributes:
      TRANSITION_DELAY: '0'
      TRANSITION_RETRY_COUNT: '0'
      display: type=ElbowH,x=727,y=107,xs=587&896,ys=56&160
    to: s3
- id: s4
  name: XSLT transformation
  path: flowbee-demo.transform.TransformActivity
  attributes:
    Input Documents: inputxml
    Output Documents: response
    Rule: ""
    SCRIPT: XSLT
    Transform Language: GPath
    display: x=320,y=544,w=190,h=57
  links:
  - id: l14
    attributes:
      TRANSITION_DELAY: '0'
      TRANSITION_RETRY_COUNT: '0'
      display: type=ElbowH,x=748,y=137,xs=514&846&846&896,ys=569&569&160&160
    to: s3
- id: s13
  name: case?
  path: flowbee-demo.decision
  attributes:
    Expression: processCase
    SCRIPT: Groovy
    display: x=147,y=266,w=76,h=68
  links:
  - id: l17
    attributes:
      display: type=Elbow,x=397,y=68,xs=227&479,ys=300&56
    to: s6
    result: GetOrder
  - id: l18
    attributes:
      display: type=Elbow,x=365,y=310,xs=227&431,ys=302&302
    to: s8
    result: Adapter
  - id: l19
    attributes:
      display: type=Elbow,x=364,y=388,xs=227&428,ys=300&421
    to: s10
    result: LoadTest
  - id: l20
    attributes:
      display: type=Elbow,x=362,y=508,xs=185&415,ys=338&540
    to: s4
    result: XSLT
  - id: l22
    attributes:
      display: type=Elbow,x=392,y=230,xs=227&544,ys=300&166
    to: s14
    result: SyntaxError
- id: s14
  name: Syntax Error
  path: flowbee-demo.java.DynamicJavaActivity
  attributes:
    Java: ""
    display: x=548,y=136,w=100,h=60
  links:
  - id: l23
    attributes:
      display: type=Elbow,x=774,y=160,xs=652&896,ys=160&160
    to: s3
variables:
  count:
    type: java.lang.Integer
  inputxml:
    type: org.apache.xmlbeans.XmlObject
  order:
    type: model.StringDocument
  processCase:
    type: java.lang.String
  req:
    type: model.StringDocument
  response:
    type: org.w3c.dom.Document
