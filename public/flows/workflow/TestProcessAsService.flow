attributes:
  NodeStyle: BoxIcon
  PROCESS_VISIBILITY: SERVICE
  Response to Invoker: When Terminate
  START_TRANSITION_ID: '2331845'
  Transition with no Label: Matches Any Return Code
  display: x=48,y=37,w=248,h=27
steps:
- id: S7
  name: Start
  specifier: com.centurylink.mdw.workflow.activity.process.ProcessStartActivity
  attributes:
    display: x=26,y=280,w=60,h=40
  links:
  - id: L21
    attributes:
      display: type=Elbow,x=116,y=300,xs=90&143,ys=300&300
    event: FINISH
    to: S13
- id: S1
  name: Count > 100?
  specifier: com.centurylink.mdw.workflow.activity.script.ScriptEvaluator
  attributes:
    Expression: 'count > 99 ?  ''TRUE'' : ''FALSE'''
    SCRIPT: Groovy
    display: x=704,y=392,w=90,h=47
  links:
  - id: L10
    attributes:
      TRANSITION_DELAY: '0'
      TRANSITION_RETRY_COUNT: '0'
      display: type=ElbowH,x=856,y=363,xs=798&896,ys=415&160
    event: FINISH
    to: S3
    result: 'TRUE'
  - id: L11
    attributes:
      TRANSITION_DELAY: '0'
      TRANSITION_RETRY_COUNT: '200'
      display: type=Elbow,x=749,y=461,xs=749&749,ys=443&483
    event: FINISH
    to: S9
    result: 'FALSE'
- id: S2
  name: Display Response
  specifier: com.centurylink.mdw.workflow.activity.script.ScriptExecutorActivity
  attributes:
    Rule: println response
    SCRIPT: Groovy
    display: x=687,y=268,w=100,h=60
  links:
  - id: L7
    attributes:
      display: type=Elbow,x=666,y=261,xs=791&896,ys=298&160
    event: FINISH
    to: S3
- id: S12
  name: Call a web service
  specifier: com.centurylink.mdw.workflow.adapter.soap.DocumentWebServiceAdapter
  attributes:
    DO_LOGGING: 'True'
    PostScriptLang: Groovy
    PreScriptLang: Groovy
    REQUEST_VARIABLE: req
    RESPONSE_VARIABLE: response
    SERVICE: invokeWebService
    WSDL: '#{props[''mdw.services.url'']}/SOAP/Employee.wsdl'
    display: x=564,y=272,w=100,h=60
  links:
  - id: L6
    attributes:
      display: type=Elbow,x=660,y=293,xs=668&683,ys=300&300
    event: FINISH
    to: S2
- id: S10
  name: count = 0
  specifier: com.centurylink.mdw.workflow.activity.script.ScriptExecutorActivity
  attributes:
    Rule: |-
      /*document response;
       & $response = "LoadTestResponse";
       $response.Status = "OK";
       $count = 0;
       */
      import javax.xml.parsers.DocumentBuilder;
      import javax.xml.parsers.DocumentBuilderFactory;
      import org.w3c.dom.Document;
      import org.w3c.dom.Element;

      DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
      DocumentBuilder builder = dbf.newDocumentBuilder();

      Document response = builder.newDocument();
      Element element = response.createElement("LoadTestResponse");
      response.appendChild(element);

      Element itemElement = response.createElement("Status");
      itemElement.appendChild(response.createTextNode('OK'));
      element.appendChild(itemElement);

      count=0
    SCRIPT: Groovy
    display: x=432,y=391,w=100,h=60
  links:
  - id: L9
    attributes:
      display: type=Elbow,x=622,y=415,xs=536&700,ys=415&415
    event: FINISH
    to: S1
- id: S8
  name: Set up request
  specifier: com.centurylink.mdw.workflow.activity.script.ScriptExecutorActivity
  attributes:
    Output Documents: req
    Rule: "req = '''<GetEmployee>\r\n  <workstationId>dxoakes</workstationId>\r\n</GetEmployee>'''"
    SCRIPT: Groovy
    display: x=435,y=272,w=100,h=60
  links:
  - id: L5
    attributes:
      display: type=ElbowH,x=552,y=302,xs=539&560,ys=302&302
    event: FINISH
    to: S12
- id: S9
  name: count = count + 1
  specifier: com.centurylink.mdw.workflow.activity.script.ScriptExecutorActivity
  attributes:
    Rule: |
      count = count + 1;
    SCRIPT: Groovy
    display: x=699,y=487,w=100,h=60
  links:
  - id: L12
    attributes:
      TRANSITION_DELAY: '0'
      TRANSITION_RETRY_COUNT: '200'
      display: type=ElbowH,x=749,y=413,xs=695&616&616&700,ys=504&504&416&416
    event: FINISH
    to: S1
- id: S3
  name: Stop
  specifier: com.centurylink.mdw.workflow.activity.process.ProcessFinishActivity
  attributes:
    display: x=900,y=140,w=60,h=40
- id: S6
  name: Get OrderId
  specifier: com.centurylink.mdw.workflow.activity.script.ScriptExecutorActivity
  attributes:
    Output Documents: response
    Rule: |-
      import groovy.util.XmlParser

      def orderDoc = new XmlParser().parseText(order)
      def orderId = orderDoc.orderId.text()
      response = "<orderId>" + orderId + "</orderId>"
    SCRIPT: Groovy
    display: x=483,y=26,w=100,h=60
  links:
  - id: L16
    attributes:
      TRANSITION_DELAY: '0'
      TRANSITION_RETRY_COUNT: '0'
      display: type=ElbowH,x=727,y=107,xs=587&896,ys=56&160
    event: FINISH
    to: S3
- id: S4
  name: XSLT transformation
  specifier: com.centurylink.mdw.workflow.activity.transform.TransformActivity
  attributes:
    Input Documents: inputxml
    Output Documents: response
    Rule: "<xsl:stylesheet version=\"1.0\" \n   xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n   xmlns=\"http://www.cramer.com/centurylink/srpf\"\n   xmlns:s=\"http://www.cramer.com/centurylink/srpf\"\n   xmlns:bim=\"http://www.centurylink.com/XMLSchema/BIM\"\n   xmlns:q=\"http://mdw.centurylink.com/XMLSchema\">\n\n<xsl:output method=\"html\" indent=\"yes\" omit-xml-declaration=\"yes\"/>\n\n<xsl:template match=\"/\">\n  <html>\n   <body>\n     <h2>SeRT Order\n <xsl:value-of select='s:OrderRetrieval/s:RequestType'/>\n     </h2>\n     <table>\n       <tr><th>Field</th><th>Value</th></tr>\n       <tr><td>Customer Name</td>\n    <td><xsl:value-of select=\n   's:OrderRetrieval/s:OrderDetails/s:Customer/s:CustomerFullName'/>\n           </td></tr>\n     </table>\n   </body>\n  </html>\n</xsl:template>\n\n</xsl:stylesheet>\n\n"
    SCRIPT: XSLT
    Transform Language: GPath
    display: x=320,y=544,w=190,h=57
  links:
  - id: L14
    attributes:
      TRANSITION_DELAY: '0'
      TRANSITION_RETRY_COUNT: '0'
      display: type=ElbowH,x=748,y=137,xs=514&846&846&896,ys=569&569&160&160
    event: FINISH
    to: S3
- id: S13
  name: case?
  specifier: com.centurylink.mdw.workflow.activity.script.ScriptEvaluator
  attributes:
    Expression: processCase
    SCRIPT: Groovy
    display: x=147,y=266,w=76,h=68
  links:
  - id: L17
    attributes:
      display: type=Elbow,x=397,y=68,xs=227&479,ys=300&56
    event: FINISH
    to: S6
    result: GetOrder
  - id: L18
    attributes:
      display: type=Elbow,x=365,y=310,xs=227&431,ys=302&302
    event: FINISH
    to: S8
    result: Adapter
  - id: L19
    attributes:
      display: type=Elbow,x=364,y=388,xs=227&428,ys=300&421
    event: FINISH
    to: S10
    result: LoadTest
  - id: L20
    attributes:
      display: type=Elbow,x=362,y=508,xs=185&415,ys=338&540
    event: FINISH
    to: S4
    result: XSLT
  - id: L22
    attributes:
      display: type=Elbow,x=392,y=230,xs=227&544,ys=300&166
    event: FINISH
    to: S14
    result: SyntaxError
- id: S14
  name: Syntax Error
  specifier: com.centurylink.mdw.workflow.activity.java.DynamicJavaActivity
  attributes:
    Java: "package com.centurylink.mdw.tests.workflow;\r\n\r\nimport java.util.Map;\r\n\r\nimport com.centurylink.mdw.java.JavaExecutionException;\r\nimport com.centurylink.mdw.java.JavaExecutor;\r\nimport com.centurylink.mdw.java.MdwJavaException;\r\nimport com.centurylink.mdw.model.workflow.ActivityRuntimeContext;\r\n\r\npublic class SyntaxError_A14 implements JavaExecutor {\r\n  \r\n    public void initialize(ActivityRuntimeContext context) throws MdwJavaException {\r\n    }\r\n\r\n    public Object execute(Map<String, Object> variables) throws JavaExecutionException {\r\n        this is not java\r\n    }\r\n\r\n}\r\n"
    display: x=548,y=136,w=100,h=60
  links:
  - id: L23
    attributes:
      display: type=Elbow,x=774,y=160,xs=652&896,ys=160&160
    event: FINISH
    to: S3
variables:
  count:
    type: java.lang.Integer
  inputxml:
    type: org.apache.xmlbeans.XmlObject
  order:
    type: com.centurylink.mdw.model.StringDocument
  processCase:
    type: java.lang.String
  req:
    type: com.centurylink.mdw.model.StringDocument
  response:
    type: org.w3c.dom.Document
