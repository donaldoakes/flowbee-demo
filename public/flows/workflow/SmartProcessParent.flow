attributes:
  ArrowStyle: ArrowEnd
  NodeStyle: BoxIcon
  PROCESS_VISIBILITY: PUBLIC
  display: x=50,y=56,w=184,h=27
steps:
- id: S1
  name: Start
  specifier: flowbee-demo.start
  attributes:
    display: x=58,y=141,w=60,h=40
  links:
  - id: L1
    attributes:
      display: type=Elbow,x=149,y=161,xs=122&177,ys=161&161
    event: FINISH
    to: S5
- id: S2
  name: Stop
  specifier: flowbee-demo.stop
  attributes:
    Monitors: '[["true","Milestone","milestones/ActivityMilestone.java","Completed"],["false","Test Cases","testing/TestCaseActivityMonitor.java",""],["false","Zipkin Activity","zipkin/TraceActivityMonitor.java",""]]'
    display: x=686,y=173,w=60,h=40
- id: S5
  name: "Test\r\nCase?"
  specifier: flowbee-demo.script.ScriptEvaluator
  attributes:
    Expression: '#{testCase}'
    SCRIPT: javax.el
    display: x=181,y=138,w=89,h=46
  links:
  - id: L3
    attributes:
      display: type=Elbow,x=285,y=103,xs=274&378,ys=161&90
    event: FINISH
    to: S11
    result: single
  - id: L4
    attributes:
      display: type=Elbow,x=300,y=196,xs=270&297&297&354,ys=173&173&244&244
    event: FINISH
    to: S8
    result: multiple
- id: S8
  name: Create Plan
  specifier: flowbee-demo.script.ScriptExecutorActivity
  attributes:
    Monitors: '[["true","Milestone","milestones/ActivityMilestone.java","Plan Created"],["false","Test Cases","testing/TestCaseActivityMonitor.java",""],["false","Zipkin Activity","zipkin/TraceActivityMonitor.java",""]]'
    Output Documents: executionPlan
    Rule: |
      import bpm.ProcessExecutionPlanDocument
      import bpm.ParameterDocument.Parameter
      import bpm.ProcessExecutionPlanDocument.ProcessExecutionPlan
      import bpm.SubprocessInstanceDocument.SubprocessInstance
      import model.workflow.WorkStatus

      executionPlan = ProcessExecutionPlanDocument.Factory.newInstance();
      ProcessExecutionPlan exeplan = executionPlan.addNewProcessExecutionPlan();
      SubprocessInstance subprocinst = exeplan.addNewSubprocessInstance();
      subprocinst.setLogicalProcessName("SmartProcessChild");
      subprocinst.setStatusCode(WorkStatus.STATUS_PENDING_PROCESS.intValue());
      addParameter(subprocinst, "inputVar", "child11");
      addParameter(subprocinst, "procName", "\$");
      addParameter(subprocinst, "procVer", "\$");
      subprocinst = exeplan.addNewSubprocessInstance();
      subprocinst.setLogicalProcessName("SmartProcessChild");
      subprocinst.setStatusCode(WorkStatus.STATUS_PENDING_PROCESS.intValue());
      addParameter(subprocinst, "inputVar", "child12");
      subprocinst = exeplan.addNewSubprocessInstance();
      subprocinst.setLogicalProcessName("SmartProcessChild2");
      subprocinst.setStatusCode(WorkStatus.STATUS_PENDING_PROCESS.intValue());
      addParameter(subprocinst, "inputVar", "\$subprocInputVar");
      addParameter(subprocinst, "procName", "\$");
      addParameter(subprocinst, "procVer", "\$");

      void addParameter(SubprocessInstance subprocinst, String name, String value) {
       Parameter param = subprocinst.addNewParameter();
       param.setName(name);
       param.setStringValue(value);
      }
    SCRIPT: Groovy
    display: x=358,y=210,w=100,h=60
  links:
  - id: L10
    attributes:
      display: type=Elbow,x=408,y=301,xs=408&408,ys=274&328
    event: FINISH
    to: S10
- id: S9
  name: Assign Output
  specifier: flowbee-demo.script.ScriptExecutorActivity
  attributes:
    Monitors: '[["true","Milestone","milestones/ActivityMilestone.java","Output Assigned"],["false","Test Cases","testing/TestCaseActivityMonitor.java",""],["false","Zipkin Activity","zipkin/TraceActivityMonitor.java",""]]'
    Rule: ""
    SCRIPT: Groovy
    display: x=535,y=337,w=100,h=60
  links:
  - id: L8
    attributes:
      display: type=Elbow,x=674,y=285,xs=639&716,ys=367&217
    event: FINISH
    to: S2
- id: S10
  name: Invoke Multiple
  specifier: flowbee-demo.process.InvokeHeterogeneousProcessActivity
  attributes:
    DELAY_BETWEEN: '1'
    Execution Plan: executionPlan
    display: x=355,y=332,w=109,h=65
    processmap: '[["SmartProcessChild","tests.workflow/SmartProcessChild.proc","[2.4,3)"],["SmartProcessChild2","tests.workflow/SmartProcessChild2.proc","[0.4,1)"]]'
    synchronous: 'true'
  links:
  - id: L11
    attributes:
      display: type=Elbow,x=499,y=367,xs=468&531,ys=367&367
    event: FINISH
    to: S9
- id: S11
  name: Invoke Single
  specifier: flowbee-demo.process.InvokeSubProcessActivity
  attributes:
    display: x=382,y=61,w=100,h=60
    processname: tests.workflow/SmartProcessChild.proc
    processversion: '[2.4,3)'
    synchronous: 'true'
    variables: '{"procVer":"${singleSubprocVer}","inputVar":"${testCaseJson.name}","procName":"${singleSubprocName}"}'
  links:
  - id: L12
    attributes:
      display: type=Elbow,x=584,y=141,xs=486&682,ys=90&193
    event: FINISH
    to: S2
variables:
  executionPlan:
    type: org.apache.xmlbeans.XmlObject
  multipleSubprocName:
    type: java.lang.String
  multipleSubprocName2:
    type: java.lang.String
  multipleSubprocVer:
    type: java.lang.String
  multipleSubprocVer2:
    type: java.lang.String
  singleSubprocName:
    type: java.lang.String
  singleSubprocNameOld:
    type: java.lang.String
  singleSubprocVer:
    type: java.lang.String
  singleSubprocVerOld:
    type: java.lang.String
  subprocInputVar:
    type: java.lang.String
  testCase:
    type: java.lang.String
  testCaseJson:
    type: io.limberest.json.Jsonable
