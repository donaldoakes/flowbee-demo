attributes:
  ArrowStyle: ArrowEnd
  NodeStyle: BoxIcon
  PROCESS_VISIBILITY: PUBLIC
  display: x=21,y=21,w=101,h=27
steps:
- id: S1
  name: Start
  path: flowbee-demo.start
  attributes:
    display: x=250,y=11,w=60,h=40
  links:
  - id: L1
    attributes:
      display: type=Elbow,x=253,y=9,xs=246&207,ys=31&161
    to: S3
  - id: L3
    attributes:
      display: type=Elbow,x=283,y=63,xs=289&289,ys=55&84
    to: S10
  - id: L6
    attributes:
      display: type=Elbow,x=322,y=28,xs=314&338,ys=32&32
    to: S9
- id: S2
  name: Stop
  path: flowbee-demo.stop
  attributes:
    display: x=261,y=400,w=60,h=40
- id: S3
  name: "Query Using\r\nJDBC URL"
  path: flowbee-demo.adapter.db.JdbcSqlAdapter
  attributes:
    Output Documents: userDocument
    PostScript: "import java.sql.ResultSet\r\nimport model.user.User\r\n\r\nResultSet rs = (ResultSet) response;\r\nif (rs.next()) {\r\n    User user = new User();\r\n    user.setCuid(rs.getString(\"cuid\"))\r\n    user.setName(rs.getString(\"name\"))\r\n    userDocument = user.getJson();\r\n}\r\nelse {\r\n    throw new RuntimeException(\"User query returns no results: \" + runtimeContext.getAttributes().get(\"sqlQuery\"));\r\n}"
    PostScriptLang: Groovy
    PreScriptLang: Groovy
    display: x=101,y=124,w=102,h=75
    jdbcDataSource: MyDataSource
    parameterVariable: userCuid
    queryType: Select
    sqlQuery: select * from USER_INFO where cuid = ?
  links:
  - id: L2
    attributes:
      display: type=Elbow,x=181,y=246,xs=152&278,ys=203&289
    to: S5
- id: S4
  name: "Query Multiple Params,\r\nMultiple Results"
  path: flowbee-demo.adapter.db.JdbcSqlAdapter
  attributes:
    Output Documents: supportUsers
    PostScript: "import java.sql.ResultSet\r\n\r\nResultSet rs = (ResultSet) response;\r\nsupportUsers = new ArrayList<String>();\r\nwhile (rs.next()) {\r\n  supportUsers.add(rs.getString(\"name\"));\r\n}\r\n"
    PostScriptLang: Groovy
    PreScriptLang: Groovy
    display: x=304,y=185,w=145,h=78
    jdbcDataSource: MyDataSource
    parameterVariable: userCuids
    queryType: Select
    sqlQuery: "select * from USER_INFO ui, USER_GROUP_MAPPING ugm, USER_GROUP ug\r\nwhere ui.user_info_id = ugm.user_info_id\r\nand ugm.user_group_id = ug.user_group_id\r\nand ug.group_name = 'Site Admin'\r\nand (ui.cuid = ? or ui.cuid = ?) \r\norder by cuid desc"
  links:
  - id: L5
    attributes:
      display: type=Elbow,x=316,y=276,xs=316&316,ys=267&289
    to: S5
- id: S5
  name: Sync
  path: flowbee-demo.sync.SynchronizationActivity
  attributes:
    STATUS_AFTER_EVENT: Cancelled
    Synced Activities: "Query Using\r\nJDBC URL#Query Multiple Params,\r\nMultiple Results#Reset\r\nUser Name"
    display: x=228,y=293,w=100,h=60
  links:
  - id: L4
    attributes:
      display: type=Elbow,x=291,y=344,xs=291&291,ys=357&396
    to: S2
- id: S6
  name: "Update\r\nUser Name"
  path: flowbee-demo.adapter.db.JdbcSqlAdapter
  attributes:
    DESCRIPTION: Where clause is hard-coded to avoid any mishaps due to bad input data.
    display: x=472,y=13,w=100,h=66
    jdbcDataSource: MyDataSource
    queryType: Update
    sqlQuery: update USER_INFO set name = 'Don Oakes' where cuid = 'dxoakes'
  links:
  - id: L7
    attributes:
      display: type=Elbow,x=525,y=111,xs=525&525,ys=83&149
    to: S7
- id: S7
  name: "Select User\r\nAnd Bind Name"
  path: flowbee-demo.adapter.db.JdbcSqlAdapter
  attributes:
    PostScript: "import java.sql.ResultSet\r\n\r\nResultSet rs = (ResultSet) response;\r\nif (rs.next()) {\r\n  return rs.getString(\"name\");\r\n}"
    PostScriptLang: Groovy
    PreScriptLang: Groovy
    display: x=479,y=153,w=100,h=72
    jdbcDataSource: MyDataSource
    queryType: Select
    sqlQuery: select name from USER_INFO where cuid = 'dxoakes'
  links:
  - id: L8
    attributes:
      display: type=Elbow,x=535,y=248,xs=527&527,ys=229&287
    to: S8
    result: Don Oakes
- id: S8
  name: "Reset\r\nUser Name"
  path: flowbee-demo.adapter.db.JdbcSqlAdapter
  attributes:
    DESCRIPTION: Where clause is hard-coded to avoid any mishaps due to bad input data.
    PostScriptLang: Groovy
    PreScriptLang: Groovy
    display: x=474,y=291,w=101,h=67
    jdbcDataSource: MyDataSource
    queryType: Update
    sqlQuery: update USER_INFO set name = 'Donald Oakes' where cuid = 'dxoakes'
  links:
  - id: L9
    attributes:
      display: type=Elbow,x=401,y=323,xs=470&332,ys=323&323
    to: S5
- id: S9
  name: Wait 60s
  path: flowbee-demo.timer.TimerWaitActivity
  attributes:
    STATUS_AFTER_EVENT: Cancelled
    TIMER_WAIT: '60'
    Unit: Seconds
    display: x=342,y=13,w=100,h=60
  links:
  - id: L10
    attributes:
      display: type=Elbow,x=457,y=43,xs=446&468,ys=43&43
    to: S6
- id: S10
  name: Wait 10s
  path: flowbee-demo.timer.TimerWaitActivity
  attributes:
    STATUS_AFTER_EVENT: Cancelled
    TIMER_WAIT: '10'
    Unit: Seconds
    display: x=268,y=88,w=100,h=60
  links:
  - id: L11
    attributes:
      display: type=Elbow,x=336,y=166,xs=336&336,ys=152&181
    to: S4
variables:
  supportUsers:
    type: java.util.List<String>
  userCuid:
    type: java.lang.String
  userCuids:
    type: java.util.List<String>
  userDocument:
    type: org.json.JSONObject
