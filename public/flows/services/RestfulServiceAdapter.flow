attributes:
  NodeStyle: BoxIcon
  display: x=39,y=38,w=202,h=27
steps:
- id: S1
  name: Start
  specifier: com.centurylink.mdw.workflow.activity.process.ProcessStartActivity
  attributes:
    display: x=72,y=117,w=60,h=40
  links:
  - id: L13
    attributes:
      display: type=Elbow,x=179,y=137,xs=136&202,ys=137&137
    event: FINISH
    to: S10
- id: S6
  name: Stop
  specifier: com.centurylink.mdw.workflow.activity.process.ProcessFinishActivity
  attributes:
    display: x=595,y=119,w=60,h=40
- id: S5
  name: Stop
  specifier: com.centurylink.mdw.workflow.activity.process.ProcessFinishActivity
  attributes:
    display: x=680,y=229,w=60,h=40
- id: S9
  name: "POST\r\nRequest"
  specifier: com.centurylink.mdw.workflow.adapter.rest.RestServiceAdapter
  attributes:
    ConnectTimeout: '60000'
    DO_LOGGING: 'True'
    EndpointUri: '#{props[''mdw.services.url'']}/Services/REST'
    HeadersVariable: headersMap
    HttpMethod: POST
    PostScriptLang: Groovy
    PreScriptLang: Groovy
    REQUEST_VARIABLE: requestDoc
    RESPONSE_VARIABLE: responseDoc
    ReadTimeout: '60000'
    display: x=442,y=213,w=121,h=76
  links:
  - id: L12
    attributes:
      display: type=Elbow,x=633,y=247,xs=567&676,ys=249&249
    event: FINISH
    to: S5
- id: S8
  name: "GET\r\nRequest"
  specifier: com.centurylink.mdw.workflow.adapter.rest.RestServiceAdapter
  attributes:
    DO_LOGGING: 'True'
    EndpointUri: '#{props[''mdw.services.url'']}/services/AppSummary'
    HeadersVariable: headersMap
    HttpMethod: GET
    PostScriptLang: Groovy
    PreScriptLang: Groovy
    RESPONSE_VARIABLE: responseDoc
    display: x=412,y=104,w=116,h=74
  links:
  - id: L3
    attributes:
      display: type=Elbow,x=566,y=143,xs=532&591,ys=139&139
    event: FINISH
    to: S6
- id: S10
  name: Set Request
  specifier: com.centurylink.mdw.workflow.activity.java.DynamicJavaActivity
  attributes:
    ClassName: SetRequest_A10
    Java: |
      package com.centurylink.mdw.tests.services;

      import java.util.Map;
      import java.util.HashMap;

      import com.centurylink.mdw.java.JavaExecutionException;
      import com.centurylink.mdw.java.JavaExecutor;
      import com.centurylink.mdw.java.MdwJavaException;
      import com.centurylink.mdw.model.user.User;
      import com.centurylink.mdw.model.user.Workgroup;
      import com.centurylink.mdw.model.workflow.ActivityRuntimeContext;
      import com.centurylink.mdw.tests.services.GetEmployee;

      public class SetRequest_A10 implements JavaExecutor {

          public void initialize(ActivityRuntimeContext context) throws MdwJavaException {
          }

          public Object execute(Map<String, Object> variables) throws JavaExecutionException {
              String httpMethod = (String) variables.get("httpMethod");
              if (httpMethod.equals("POST")) {
                  GetEmployee requestDoc = new GetEmployee();
                  requestDoc.setWorkstationId("dxoakes");
                  variables.put("requestDoc", requestDoc);
                  Map<String,String> headers = new HashMap<String,String>();
                  headers.put("my-header", "my-header-value");
                  headers.put("Content-Type", "text/xml");
                  variables.put("headersMap", headers);
              }
              else if (httpMethod.equals("PATCH")) {
                  Workgroup workgroup = new Workgroup(0L, "Patchy Developers", "Dev Group for PATCH");
                  workgroup.setUsers(new User[] { new User("dxoakes") });
                  try {
                      variables.put("patchRequest", workgroup.getJson());
                  }
                  catch (org.json.JSONException ex) {
                      throw new JavaExecutionException(ex.getMessage(), ex);
                  }
              }
              return httpMethod;
          }

      }
    Output Documents: requestDoc#patchRequest#headersMap
    display: x=206,y=104,w=120,h=74
  links:
  - id: L14
    attributes:
      display: type=Elbow,x=358,y=149,xs=330&408,ys=141&141
    event: FINISH
    to: S8
    result: GET
  - id: L15
    attributes:
      display: type=ElbowV,x=337,y=226,xs=310&310&438,ys=182&250&250
    event: FINISH
    to: S9
    result: POST
  - id: L16
    attributes:
      display: type=Elbow,x=272,y=271,xs=266&266,ys=182&317
    event: FINISH
    to: S11
    result: PATCH
- id: S11
  name: "PATCH\r\nRequest"
  specifier: com.centurylink.mdw.workflow.adapter.rest.RestServiceAdapter
  attributes:
    ConnectTimeout: '30000'
    DO_LOGGING: 'True'
    EndpointUri: '#{props[''mdw.services.url'']}/services/com/centurylink/mdw/tests/services/PatchHandler'
    HttpMethod: PATCH
    PostScriptLang: Groovy
    PreScriptLang: Groovy
    REQUEST_VARIABLE: patchRequest
    RESPONSE_VARIABLE: patchResponse
    ReadTimeout: '30000'
    display: x=205,y=321,w=126,h=79
  links:
  - id: L17
    attributes:
      display: type=Elbow,x=394,y=361,xs=335&453,ys=361&361
    event: FINISH
    to: S12
- id: S12
  name: Stop
  specifier: com.centurylink.mdw.workflow.activity.process.ProcessFinishActivity
  attributes:
    display: x=457,y=341,w=60,h=40
variables:
  headersMap:
    type: java.util.Map<String,String>
  httpMethod:
    type: java.lang.String
  patchRequest:
    type: org.json.JSONObject
  patchResponse:
    type: org.json.JSONObject
  requestDoc:
    type: javax.xml.bind.JAXBElement
  responseDoc:
    type: com.centurylink.mdw.model.StringDocument
